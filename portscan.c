// gcc portscan.c -Wall -o portscan.c.out

/*
 * This program will:
 * - Parse command line args (--help/-h, --verbose/-v, --ports/-p = all, range, top1000)
 * - Take one or multiple IP Addresses from STDIn
 * - Parity check getServiceByPort
 * - Check if host(s) are online
 * - scan selected ports, return values
*/


#include <stdio.h>
#include <netdb.h>
#include <stdlib.h>
#include <string.h>

const char* getServiceByPort(int portNumber) {
  struct servent *service = getservbyport(htons(portNumber), NULL);
  if (service == NULL) {
    return "unknown";
  } else {
    return service->s_name;
  }
}

int main(int argc, char *argv[]){

  // Parse command line arguments
  for(int i = 0; i < argc; i++) {
    if (strcmp(argv[i], "-h") == 0 || strcmp(argv[i], "--help") == 0) {
      printf("Usage: %s [OPTION...] IP1 IP2 .. IPN...\n", argv[0]);
      printf("\n");
      printf("  -h, --help\t\tgives this help list\n");
      printf("  -v, --verbose\t\tuse verbose outputting\n");
      printf("  -p, --ports=MODE\tuse a specific port selection\n");
      printf("\n");
      printf(" Modes:\n");
      printf("  all\t\t\tall ports between 1 & 65535 will be used (slower)\n");
      printf("  top1000\t\ttop 1000 most used ports will be used (faster)\n");
      printf("  <min-max>\t\tports will be scanned between <min> and <max>, i.e\n");
      printf("\t\t\t  $ %s -p 3-10 192.168.0.4 192.168.0.5\n", argv[0]);
      printf("\t\t\t  all ports between 3 and 10 will be scanned, on both selected host(s)\n");
      printf("  p1,p2,...pN\t\tselected ports will be scanned, i.e\n");
      printf("\t\t\t  $ %s -p 22,80,443,21 10.0.0.1 10.0.0.5\n", argv[0]);
      printf("\t\t\t  only ports 22, 80, 443, and 21 will be scanned on selected host(s)\n");
      printf("\n");
      printf("All options are optional, and the top 1000 ports will be selected by default\n");
      printf("\n");
      printf("Report bugs to this pograms github issues page\n");
      return 0;
    }

  }

  return 0;
}
